<mat-stepper [linear]="true" #stepper [disableRipple]="true" id="stepper"
             (selectionChange)="this.stepChanged($event)">
  <mat-step [stepControl]="uploadFormGroup" [editable]="isEditable">
    <form [formGroup]="uploadFormGroup">
      <ng-template matStepLabel>{{'bulkIdGeneration.upload_label' | translate}}</ng-template>
      <app-message-card [type]="'error'"
                        [message]="fileInput.ngControl.getError('csvError')?.value || ''">
      </app-message-card>
      <div style="margin: 1% auto 0 auto; width: 66%;">{{'bulkIdGeneration.upload_info_text1' | translate}}
        <br/>
        {{'bulkIdGeneration.upload_info_text2' | translate}}
        <br/>
        {{'bulkIdGeneration.upload_info_text3' | translate}}
        <br/>
        {{'bulkIdGeneration.upload_info_text4' | translate}}
      </div>
      <div style="margin-top: 1%; display: flex; justify-content: center;">
        <mat-form-field style="float: left;">
          <ngx-mat-file-input
            #fileInput
            [multiple]="false"
            [placeholder]="'file.csv'"
            [accept]="'text/csv,.csv'"
            [formControlName]="'uploadField'"
          ></ngx-mat-file-input>
        </mat-form-field>
        <mat-spinner *ngIf="this.readingInProgress" style="margin-left: 10px; margin-top: 18px;" diameter="28"></mat-spinner>
      </div>
    </form>
  </mat-step>
  <mat-step #stepTwo [editable]="isEditable">
    <ng-template matStepLabel>{{'bulkIdGeneration.generate_id_label' | translate}}</ng-template>
    <div class="float-container">
      <div class="float-table">
        <bulk-id-generation-table *ngIf="step == 1" [csvRecords]="csvRecords"></bulk-id-generation-table>
      </div>
      <div class="float-content">
        <div>
          <mat-form-field style="width: 245px;">
            <mat-label>{{'bulkIdGeneration.id_type_label' | translate}}</mat-label>
            <mat-select #select (selectionChange)="dataModel = $event.value">
              <mat-option *ngFor="let idType of geIdTypes(this.idType)" [value]="idType">
                {{idType}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <button id="back" mat-raised-button
                  (click)="backToFirst()">{{'button_stepper_back' | translate}}</button>
          <button style="margin-left: 10px"
                  mat-raised-button
                  class="submit"
                  (click)="generateNewIds(dataModel)"
                  [disabled]="dataModel == ''">
            {{'button_stepper_generate_ids' | translate}}
          </button>
        </div>
      </div>
    </div>
  </mat-step>
  <mat-step #stepThree>
    <ng-template matStepLabel>{{'bulkIdGeneration.download_label' | translate}}</ng-template>
    <div class="float-container">
      <div class="float-table">
        <bulk-id-generation-table *ngIf="step == 2" [csvRecords]="csvRecords"></bulk-id-generation-table>
      </div>
      <div class="float-content">
        <div>
          <button
            id="downloadFile"
            class="submit"
            mat-raised-button
            (click)="downloadCSV()">
            <mat-icon style="margin-right: 0.2em;">download</mat-icon>
            <span>{{'button_stepper_download_csv' | translate}}</span>
          </button>
        </div>
      </div>
    </div>
  </mat-step>
</mat-stepper>
